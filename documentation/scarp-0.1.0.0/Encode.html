<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Encode</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Encode.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">scarp-0.1.0.0: Stochastic Revealed Preferences module for the Collective Random Utility Model</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Encode</p></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:checkConsumption">checkConsumption</a> :: [<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>] -&gt; [<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>] -&gt; <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a></li><li class="src short"><a href="#v:encodeConsumption">encodeConsumption</a> :: [[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>]] -&gt; [[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>]] -&gt; [[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>]]</li><li class="src short"><a href="#v:encodeGroupConsumption">encodeGroupConsumption</a> :: [[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>]] -&gt; [[[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>]]] -&gt; [[[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>]]]</li><li class="src short"><a href="#v:choicesPerPeriod">choicesPerPeriod</a> :: <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; [[[<a href="Helpers.html#t:IChoice">IChoice</a>]]]</li><li class="src short"><a href="#v:combinations">combinations</a> :: <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; [[[<a href="Helpers.html#t:IChoice">IChoice</a>]]]</li><li class="src short"><a href="#v:combinationsPeriod">combinationsPeriod</a> :: <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; [[<a href="Helpers.html#t:IChoice">IChoice</a>]]</li><li class="src short"><a href="#v:choicesPerComposition">choicesPerComposition</a> :: <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; [[[<a href="Helpers.html#t:IChoice">IChoice</a>]]]</li><li class="src short"><a href="#v:combinePeriods">combinePeriods</a> :: [[a]] -&gt; [[a]]</li><li class="src short"><a href="#v:makeDecisionForest">makeDecisionForest</a> :: ([<a href="Helpers.html#t:HChoice3">HChoice3</a>] -&gt; <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Bool">Bool</a>) -&gt; [<a href="Helpers.html#t:HChoice3">HChoice3</a>] -&gt; <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Bool">Bool</a> -&gt; [[[<a href="Helpers.html#t:IChoice">IChoice</a>]]] -&gt; <a href="../containers-0.5.10.2/Data-Tree.html#t:Forest">Forest</a> <a href="Helpers.html#t:RChoice">RChoice</a></li><li class="src short"><a href="#v:forestToChoicespace">forestToChoicespace</a> :: <a href="../containers-0.5.10.2/Data-Tree.html#t:Forest">Forest</a> <a href="Helpers.html#t:RChoice">RChoice</a> -&gt; [<a href="Helpers.html#t:RChoice">RChoice</a>]</li><li class="src short"><a href="#v:paths">paths</a> :: <a href="../containers-0.5.10.2/Data-Tree.html#t:Tree">Tree</a> a -&gt; [[a]]</li><li class="src short"><a href="#v:classifyPaths">classifyPaths</a> :: <a href="../containers-0.5.10.2/Data-Tree.html#t:Forest">Forest</a> (<a href="Helpers.html#t:HChoice3">HChoice3</a>, <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Bool">Bool</a>, <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>) -&gt; <a href="Helpers.html#t:Paths">Paths</a></li><li class="src short"><a href="#v:asAssocMatrix">asAssocMatrix</a> :: <a href="../containers-0.5.10.2/Data-Tree.html#t:Forest">Forest</a> (<a href="Helpers.html#t:HChoice3">HChoice3</a>, <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Bool">Bool</a>, <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>) -&gt; [<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>] -&gt; <a href="../hmatrix-0.18.2.0/Numeric-LinearAlgebra-Data.html#t:AssocMatrix">AssocMatrix</a></li><li class="src short"><a href="#v:trAssocMatrix">trAssocMatrix</a> :: <a href="../hmatrix-0.18.2.0/Numeric-LinearAlgebra-Data.html#t:AssocMatrix">AssocMatrix</a> -&gt; <a href="../hmatrix-0.18.2.0/Numeric-LinearAlgebra-Data.html#t:AssocMatrix">AssocMatrix</a></li><li class="src short"><a href="#v:asAssocMatrix-39-">asAssocMatrix'</a> :: <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; [<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>] -&gt; [[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>]] -&gt; <a href="../hmatrix-0.18.2.0/Numeric-LinearAlgebra-Data.html#t:AssocMatrix">AssocMatrix</a></li><li class="src short"><a href="#v:offsetters">offsetters</a> :: [<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>] -&gt; [<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>]</li><li class="src short"><a href="#v:getChoicesPerPeriod">getChoicesPerPeriod</a> :: [<a href="../containers-0.5.10.2/Data-Tree.html#t:Tree">Tree</a> <a href="Helpers.html#t:RChoice">RChoice</a>] -&gt; [[<a href="Helpers.html#t:RChoice">RChoice</a>]]</li><li class="src short"><a href="#v:lookForIndex">lookForIndex</a> :: (<a href="Helpers.html#t:HChoice3">HChoice3</a>, [<a href="Helpers.html#t:RChoice">RChoice</a>]) -&gt; <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a></li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:checkConsumption" class="def">checkConsumption</a> :: [<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>] -&gt; [<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>] -&gt; <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a> <a href="src/Encode.html#checkConsumption" class="link">Source</a> <a href="#v:checkConsumption" class="selflink">#</a></p><div class="doc"><p>Check if consumption x is affordable under price regime p</p></div></div><div class="top"><p class="src"><a id="v:encodeConsumption" class="def">encodeConsumption</a> :: [[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>]] -&gt; [[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>]] -&gt; [[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>]] <a href="src/Encode.html#encodeConsumption" class="link">Source</a> <a href="#v:encodeConsumption" class="selflink">#</a></p><div class="doc"><p>Constructs choice path of one individual: periods (outer), encoded polyhedra (inner)
 | inner part refers to feasibility (checkConsumption) of choice in period t (outer) 
 | when budget set would be s (inner)
 | rows == cols and zero diagonal by construction</p></div></div><div class="top"><p class="src"><a id="v:encodeGroupConsumption" class="def">encodeGroupConsumption</a> :: [[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>]] -&gt; [[[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>]]] -&gt; [[[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Double">Double</a>]]] <a href="src/Encode.html#encodeGroupConsumption" class="link">Source</a> <a href="#v:encodeGroupConsumption" class="selflink">#</a></p><div class="doc"><p>Takes a vector of vectors of consumptions representing each member in the group (outer)
 | and constructions a path of encoded group consumptions</p></div></div><div class="top"><p class="src"><a id="v:choicesPerPeriod" class="def">choicesPerPeriod</a> :: <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; [[[<a href="Helpers.html#t:IChoice">IChoice</a>]]] <a href="src/Encode.html#choicesPerPeriod" class="link">Source</a> <a href="#v:choicesPerPeriod" class="selflink">#</a></p><div class="doc"><p>Returns all possible combinations of choices on in
 | Level 0 (outermost): periods
 | Level 1: choice set for household in respective period
 | Level 2: particular choice of household 
 | Level 3 (innermost): choice per individual (polyhedra)</p></div></div><div class="top"><p class="src"><a id="v:combinations" class="def">combinations</a> :: <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; [[[<a href="Helpers.html#t:IChoice">IChoice</a>]]] <a href="src/Encode.html#combinations" class="link">Source</a> <a href="#v:combinations" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:combinationsPeriod" class="def">combinationsPeriod</a> :: <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; [[<a href="Helpers.html#t:IChoice">IChoice</a>]] <a href="src/Encode.html#combinationsPeriod" class="link">Source</a> <a href="#v:combinationsPeriod" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:choicesPerComposition" class="def">choicesPerComposition</a> :: <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; [[[<a href="Helpers.html#t:IChoice">IChoice</a>]]] <a href="src/Encode.html#choicesPerComposition" class="link">Source</a> <a href="#v:choicesPerComposition" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:combinePeriods" class="def">combinePeriods</a> :: [[a]] -&gt; [[a]] <a href="src/Encode.html#combinePeriods" class="link">Source</a> <a href="#v:combinePeriods" class="selflink">#</a></p><div class="doc"><p>Takes list of period choices and constructs all resulting choice combinations
 | [[]] is unit-element of operation <a href="*">*</a> on list applicative functor
 | Each element is one choice path
 | depr</p></div></div><div class="top"><p class="src"><a id="v:makeDecisionForest" class="def">makeDecisionForest</a> :: ([<a href="Helpers.html#t:HChoice3">HChoice3</a>] -&gt; <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Bool">Bool</a>) -&gt; [<a href="Helpers.html#t:HChoice3">HChoice3</a>] -&gt; <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Bool">Bool</a> -&gt; [[[<a href="Helpers.html#t:IChoice">IChoice</a>]]] -&gt; <a href="../containers-0.5.10.2/Data-Tree.html#t:Forest">Forest</a> <a href="Helpers.html#t:RChoice">RChoice</a> <a href="src/Encode.html#makeDecisionForest" class="link">Source</a> <a href="#v:makeDecisionForest" class="selflink">#</a></p><div class="doc"><p>Constructs a forest from decision space and crawles the branches to check rationality
 | once an irrational branch is found, the rationality of all child branches is set to false
 | one-elements (start with): makeDecisionForest [] True choicespace </p></div></div><div class="top"><p class="src"><a id="v:forestToChoicespace" class="def">forestToChoicespace</a> :: <a href="../containers-0.5.10.2/Data-Tree.html#t:Forest">Forest</a> <a href="Helpers.html#t:RChoice">RChoice</a> -&gt; [<a href="Helpers.html#t:RChoice">RChoice</a>] <a href="src/Encode.html#forestToChoicespace" class="link">Source</a> <a href="#v:forestToChoicespace" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:paths" class="def">paths</a> :: <a href="../containers-0.5.10.2/Data-Tree.html#t:Tree">Tree</a> a -&gt; [[a]] <a href="src/Encode.html#paths" class="link">Source</a> <a href="#v:paths" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:classifyPaths" class="def">classifyPaths</a> :: <a href="../containers-0.5.10.2/Data-Tree.html#t:Forest">Forest</a> (<a href="Helpers.html#t:HChoice3">HChoice3</a>, <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Bool">Bool</a>, <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>) -&gt; <a href="Helpers.html#t:Paths">Paths</a> <a href="src/Encode.html#classifyPaths" class="link">Source</a> <a href="#v:classifyPaths" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:asAssocMatrix" class="def">asAssocMatrix</a> :: <a href="../containers-0.5.10.2/Data-Tree.html#t:Forest">Forest</a> (<a href="Helpers.html#t:HChoice3">HChoice3</a>, <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Bool">Bool</a>, <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>) -&gt; [<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>] -&gt; <a href="../hmatrix-0.18.2.0/Numeric-LinearAlgebra-Data.html#t:AssocMatrix">AssocMatrix</a> <a href="src/Encode.html#asAssocMatrix" class="link">Source</a> <a href="#v:asAssocMatrix" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:trAssocMatrix" class="def">trAssocMatrix</a> :: <a href="../hmatrix-0.18.2.0/Numeric-LinearAlgebra-Data.html#t:AssocMatrix">AssocMatrix</a> -&gt; <a href="../hmatrix-0.18.2.0/Numeric-LinearAlgebra-Data.html#t:AssocMatrix">AssocMatrix</a> <a href="src/Encode.html#trAssocMatrix" class="link">Source</a> <a href="#v:trAssocMatrix" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:asAssocMatrix-39-" class="def">asAssocMatrix'</a> :: <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; [<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>] -&gt; [[<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>]] -&gt; <a href="../hmatrix-0.18.2.0/Numeric-LinearAlgebra-Data.html#t:AssocMatrix">AssocMatrix</a> <a href="src/Encode.html#asAssocMatrix%27" class="link">Source</a> <a href="#v:asAssocMatrix-39-" class="selflink">#</a></p><div class="doc"><p>Histogram uses a little (dirty) trick to also count empty categories: first add one of each index, then decrease all length by one
asSparseVector :: [[HChoice3]] -&gt; [[RChoice]] -&gt; GMatrix
asSparseVector a b = mkSparse $ asAssocVector a b</p><p>depr
asAssocVector :: [[HChoice3]] -&gt; [[RChoice]] -&gt; AssocMatrix 
asAssocVector sampledPaths choicesPerPeriod = histogram 
	where
		histogram = [((head l, 0), fromIntegral (length l - 1) / fromIntegral (length sampledPaths)) | l &lt;- group (sort $ indices ++ [0..(nChoicesPerPeriod*periods-1)])]
		nChoicesPerPeriod = (head . map length) choicesPerPeriod
		periods = length choicesPerPeriod
		indices = join $ map (zipWith (offset x -&gt; offset x) (offsetters nChoicesPerPeriod)) indices'
		indices' = fromJust $ mapM (sequence . (sp -&gt; zipWith (curry lookForIndex) sp choicesPerPeriod)) sampledPaths</p><p>|depr
 combinations :: Int -&gt; [[[[Double]]]]
 combinations p = map (t -&gt; household t ++ members t) [0..(p-1)] -- not replicate3, first one without zero then append
 	where 
		household t = replicateM 2 $ map (squeeze (-1.0) t) powerset ++ map (squeeze 1.0 t) powerset
		members t = replicateM 2 (map (squeeze 0.0 t) powerset)
		squeeze d t c = take t c ++ [d] ++ drop t c
		powerset = replicateM (p-1) [-1.0,  1.0] </p></div></div><div class="top"><p class="src"><a id="v:offsetters" class="def">offsetters</a> :: [<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>] -&gt; [<a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a>] <a href="src/Encode.html#offsetters" class="link">Source</a> <a href="#v:offsetters" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:getChoicesPerPeriod" class="def">getChoicesPerPeriod</a> :: [<a href="../containers-0.5.10.2/Data-Tree.html#t:Tree">Tree</a> <a href="Helpers.html#t:RChoice">RChoice</a>] -&gt; [[<a href="Helpers.html#t:RChoice">RChoice</a>]] <a href="src/Encode.html#getChoicesPerPeriod" class="link">Source</a> <a href="#v:getChoicesPerPeriod" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:lookForIndex" class="def">lookForIndex</a> :: (<a href="Helpers.html#t:HChoice3">HChoice3</a>, [<a href="Helpers.html#t:RChoice">RChoice</a>]) -&gt; <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../accelerate-1.1.1.0/Data-Array-Accelerate.html#t:Int">Int</a> <a href="src/Encode.html#lookForIndex" class="link">Source</a> <a href="#v:lookForIndex" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.18.1</p></div></body></html>