<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Empirical</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span><span class="hs-operator">.</span><span class="hs-identifier">MWC</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-keyword">import</span><span> </span><a href="Randomization.html"><span class="hs-identifier">Randomization</span></a><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span> </span><a href="Discretization.html"><span class="hs-identifier">Discretization</span></a><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span> </span><a href="Test.html"><span class="hs-identifier">Test</span></a><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><a href="Continuous.html"><span class="hs-identifier">Continuous</span></a><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><a href="Helpers.html"><span class="hs-identifier">Helpers</span></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><a href="CollectiveAxiom.html"><span class="hs-identifier">CollectiveAxiom</span></a><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">transpose</span><span class="hs-special">,</span><span class="hs-identifier hs-var">sort</span><span class="hs-special">,</span><span class="hs-identifier hs-var">sortBy</span><span class="hs-special">,</span><span class="hs-identifier hs-var">intersperse</span><span class="hs-special">)</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">LinearAlgebra</span><span class="hs-operator">.</span><span class="hs-identifier">Sparse</span><span> </span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Binary</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Directory</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">DeepSeq</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Numeric</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">showFFloat</span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-identifier">encodeDataset</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Continuous.html#PQ"><span class="hs-identifier hs-type">PQ</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><a name="encodeDataset"><a href="Empirical.html#encodeDataset"><span class="hs-identifier">encodeDataset</span></a></a><span> </span><a name="local-6989586621679095844"><a href="#local-6989586621679095844"><span class="hs-identifier">weakCouples</span></a></a><span> </span><a name="local-6989586621679095845"><a href="#local-6989586621679095845"><span class="hs-identifier">pq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095850"><span class="hs-identifier hs-var">obsAggCPPRational</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679095849"><span class="hs-identifier hs-var">obsIndCPPRational</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">length</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679095847"><span class="hs-identifier hs-var">obsAggCPP</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679095850"><span class="hs-identifier hs-var">obsAggCPPRational</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679095846"><span class="hs-identifier hs-var">obsIndCPP</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679095849"><span class="hs-identifier hs-var">obsIndCPPRational</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span>
</span><a name="line-25"></a><span>	</span><span class="hs-keyword">where</span><span> </span><span>
</span><a name="line-26"></a><span>		</span><span class="hs-identifier">obsIndCPP</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">parseChoice</span><span> </span><span class="hs-operator">$</span><span> </span><a href="#local-6989586621679095848"><span class="hs-identifier hs-var">transpose</span></a><span> </span><a href="#local-6989586621679095848"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">transpose</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">discretizeIndiv</span><span> </span><a href="Continuous.html#discretizeIndiv"><span class="hs-identifier hs-var">pq</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Continuous.html#discretizeIndiv"><span class="hs-identifier hs-var">getYears</span></a><span> </span><a href="#local-6989586621679095845"><span class="hs-identifier hs-var">pq</span></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-27"></a><span>		</span><span class="hs-identifier">obsAggCPP</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">parseChoice</span><span> </span><span class="hs-operator">$</span><span> </span><a href="#local-6989586621679095848"><span class="hs-identifier hs-var">transpose</span></a><span> </span><a href="#local-6989586621679095848"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">transpose</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">discretizeCouple</span><span> </span><a href="Continuous.html#discretizeCouple"><span class="hs-identifier hs-var">pq</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Continuous.html#discretizeCouple"><span class="hs-identifier hs-var">getYears</span></a><span> </span><a href="#local-6989586621679095845"><span class="hs-identifier hs-var">pq</span></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-28"></a><span>		</span><span>
</span><a name="line-29"></a><span>		</span><span class="hs-identifier">parseChoice</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679095848"><a href="#local-6989586621679095848"><span class="hs-identifier">map</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tuplify</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">budget</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">IChoice</span><span> </span><a name="local-6989586621679095851"><a href="#local-6989586621679095851"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">budget</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier">Double</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">HChoice3</span><span class="hs-special">]</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>		</span><span class="hs-identifier">obsIndCPPRational</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679095849"><a href="#local-6989586621679095849"><span class="hs-identifier">filter</span></a></a><span> </span><span class="hs-identifier">checkIndividualRationality</span><span> </span><a href="CollectiveAxiom.html#checkIndividualRationality"><span class="hs-identifier hs-var">obsIndCPP</span></a><span> </span><span class="hs-comment">-- always</span><span>
</span><a name="line-32"></a><span>		</span><span class="hs-identifier">obsAggCPPRational</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679095850"><a href="#local-6989586621679095850"><span class="hs-identifier">filter</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">weakCouples</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">obsAggCPP</span><span> </span><span class="hs-comment">-- if pref stability test, not if strong test</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-identifier">empiricalByDataset</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SparseMatrix</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Continuous.html#PQ"><span class="hs-identifier hs-type">PQ</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><a name="empiricalByDataset"><a href="Empirical.html#empiricalByDataset"><span class="hs-identifier">empiricalByDataset</span></a></a><span> </span><a name="local-6989586621679095853"><a href="#local-6989586621679095853"><span class="hs-identifier">smA</span></a></a><span> </span><a name="local-6989586621679095854"><a href="#local-6989586621679095854"><span class="hs-identifier">weakCouples</span></a></a><span> </span><a name="local-6989586621679095855"><a href="#local-6989586621679095855"><span class="hs-identifier">pq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-36"></a><span>	</span><span class="hs-identifier">seed</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">create</span><span>
</span><a name="line-37"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">obsAggCPPRational</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">obsIndCPPRational</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679095858"><a href="#local-6989586621679095858"><span class="hs-identifier">ns</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">encodeDataset</span><span> </span><span class="hs-identifier">weakCouples</span><span> </span><a href="#local-6989586621679095854"><span class="hs-identifier hs-var">pq</span></a><span>
</span><a name="line-38"></a><span>	</span><span class="hs-identifier">bidcs</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">bootstrapIdcs</span><span> </span><span class="hs-special">(</span><a href="Randomization.html#bootstrapIdcs"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">obsAggCPPRational</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">obsIndCPPRational</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">obsIndCPPRational</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-number">300</span><span> </span><span class="hs-identifier">seed</span><span> </span><span class="hs-comment">-- sampleSize pq does not consider dropped ones</span><span>
</span><a name="line-39"></a><span>	</span><span class="hs-comment">-- drop couples who are not consistent with weak, and singles who are irrational</span><span>
</span><a name="line-40"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">j</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">js</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">steps</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bstepss</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">calculateTestStatistic</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-identifier hs-var">smA</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getChoicePiResampler</span><span> </span><a href="Discretization.html#getChoicePiResampler"><span class="hs-identifier hs-var">cpp</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">bidcs</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">obsAggCPPRational</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">obsIndCPPRational</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">obsIndCPPRational</span><span class="hs-special">]</span><span> </span><span>
</span><a name="line-41"></a><span>	</span><span class="hs-identifier">print</span><span> </span><span class="hs-identifier">steps</span><span>
</span><a name="line-42"></a><span>	</span><span class="hs-identifier">print</span><span> </span><span class="hs-identifier">bstepss</span><span>
</span><a name="line-43"></a><span>	</span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">filter</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-identifier hs-var">j</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">sort</span><span> </span><span class="hs-identifier">js</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">js</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Double</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ns</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-identifier">pickleEmpirical</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><a name="pickleEmpirical"><a href="Empirical.html#pickleEmpirical"><span class="hs-identifier">pickleEmpirical</span></a></a><span> </span><a name="local-6989586621679095865"><a href="#local-6989586621679095865"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679095866"><a href="#local-6989586621679095866"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeFile</span><span> </span><a href="#local-6989586621679095865"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">encode</span><span> </span><a href="#local-6989586621679095866"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-identifier">unpickleEmpirical</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-50"></a><a name="unpickleEmpirical"><a href="Empirical.html#unpickleEmpirical"><span class="hs-identifier">unpickleEmpirical</span></a></a><span> </span><a name="local-6989586621679095867"><a href="#local-6989586621679095867"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-51"></a><span>	</span><span class="hs-identifier">handle</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">openFile</span><span> </span><span class="hs-identifier hs-var">f</span><span> </span><span class="hs-identifier">ReadMode</span><span> </span><span>
</span><a name="line-52"></a><span>	</span><span class="hs-identifier">content</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a name="local-6989586621679095869"><a href="#local-6989586621679095869"><span class="hs-identifier">B</span><span class="hs-operator">.</span></a></a><span class="hs-identifier">hGetContents</span><span> </span><span class="hs-identifier hs-var">handle</span><span> </span><span>
</span><a name="line-53"></a><span>	</span><span class="hs-identifier">rnf</span><span> </span><span class="hs-identifier">content</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621679095869"><span class="hs-identifier hs-var">seq</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">hClose</span><span> </span><span class="hs-identifier hs-var">handle</span><span>
</span><a name="line-54"></a><span>	</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">decode</span><span> </span><span class="hs-identifier">content</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-identifier">resumeEmpirical</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SparseMatrix</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Continuous.html#PQ"><span class="hs-identifier hs-type">PQ</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><a name="resumeEmpirical"><a href="Empirical.html#resumeEmpirical"><span class="hs-identifier">resumeEmpirical</span></a></a><span> </span><a name="local-6989586621679095870"><a href="#local-6989586621679095870"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679095871"><a href="#local-6989586621679095871"><span class="hs-identifier">years</span></a></a><span> </span><a name="local-6989586621679095872"><a href="#local-6989586621679095872"><span class="hs-identifier">smA</span></a></a><span> </span><a name="local-6989586621679095873"><a href="#local-6989586621679095873"><span class="hs-identifier">weakCouples</span></a></a><span> </span><a name="local-6989586621679095874"><a href="#local-6989586621679095874"><span class="hs-identifier">pq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679095875"><span class="hs-identifier hs-var">loaded</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679095876"><span class="hs-identifier hs-var">decide</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><a href="#local-6989586621679095871"><span class="hs-identifier hs-var">years</span></a><span>
</span><a name="line-58"></a><span>	</span><span class="hs-keyword">where</span><span>
</span><a name="line-59"></a><span>		</span><span class="hs-identifier">loaded</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">doesFileExist</span><span> </span><span class="hs-identifier hs-var">fp</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">exists</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">exists</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">unpickleEmpirical</span><span> </span><a href="Empirical.html#unpickleEmpirical"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>		</span><span class="hs-identifier">decide</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Double</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier">Int</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Double</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier">Int</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>	</span><span>
</span><a name="line-61"></a><span>		</span><span class="hs-identifier">decide</span><span> </span><span class="hs-identifier">Nothing</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-62"></a><span>			</span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">empiricalByDataset</span><span> </span><span class="hs-identifier">smA</span><span> </span><a href="Empirical.html#empiricalByDataset"><span class="hs-identifier hs-var">weakCouples</span></a><span> </span><a href="Empirical.html#empiricalByDataset"><span class="hs-identifier hs-var">pq</span></a><span>
</span><a name="line-63"></a><span>			</span><span class="hs-identifier">rs</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">loaded</span><span>
</span><a name="line-64"></a><span>			</span><span class="hs-identifier">pickleEmpirical</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Empirical.html#pickleEmpirical"><span class="hs-identifier hs-var">years</span></a><span class="hs-special">,</span><span> </span><a href="Empirical.html#pickleEmpirical"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="Empirical.html#pickleEmpirical"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>			</span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">years</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r</span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>		</span><span class="hs-identifier">decide</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">r</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">years</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">r</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-identifier">writeTable</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><a name="writeTable"><a href="Empirical.html#writeTable"><span class="hs-identifier">writeTable</span></a></a><span> </span><a name="local-6989586621679095881"><a href="#local-6989586621679095881"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679095882"><a href="#local-6989586621679095882"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">writeFile</span><span> </span><a href="#local-6989586621679095881"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-operator hs-var">$</span><span>  </span><span class="hs-special">[</span><span class="hs-string">&quot;\\begin{tabular}{c|cc|cc|cc}\\toprule&quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679095884"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;\\midrule&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679095885"><span class="hs-identifier hs-var">printNice</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sortBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">compare</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679095882"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;\\bottomrule\\end{tabular}&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-70"></a><span>	</span><span class="hs-keyword">where</span><span>
</span><a name="line-71"></a><span>		</span><span class="hs-identifier">nheader</span><span> </span><span class="hs-identifier">t</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;$ N_{\\text{&quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">t</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot;}}^{\\text{&quot;</span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-operator">++</span><span class="hs-string">&quot;}} $&quot;</span><span>
</span><a name="line-72"></a><span>		</span><span class="hs-identifier">header</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-string">&quot;Years &amp; &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unwords</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">intersperse</span><span> </span><span class="hs-string">&quot; &amp; &quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">uncurry</span><span> </span><span class="hs-identifier">nheader</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">t</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679095883"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679095883"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;couples&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;singles&quot;</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;total&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;rational&quot;</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot; &amp; p-value &amp; \\\\&quot;</span><span> </span><span>
</span><a name="line-73"></a><span>		</span><span class="hs-identifier">printNice</span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Double</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier">Int</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">String</span><span>
</span><a name="line-74"></a><span>		</span><span class="hs-identifier">printNice</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ys</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679095885"><a href="#local-6989586621679095885"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679095885"><a href="#local-6989586621679095885"><span class="hs-identifier">ns</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unwords</span><span> </span><span class="hs-identifier">ys</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot; &amp; &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unwords</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">intersperse</span><span> </span><span class="hs-string">&quot; &amp; &quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">join</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ns</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &amp; &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">showFFloat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">p</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot; &amp; &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">stars</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot; \\\\&quot;</span><span>
</span><a name="line-75"></a><span>		</span><span class="hs-identifier">stars</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">join</span><span> </span><a name="local-6989586621679095886"><a href="#local-6989586621679095886"><span class="hs-operator">$</span></a></a><span> </span><span class="hs-identifier">replicate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">length</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">filter</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;</span><span class="hs-number">0.01</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;</span><span class="hs-number">0.05</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-operator">&lt;</span><span class="hs-number">0.1</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">p</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;*&quot;</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span>	</span><span>
</span><a name="line-78"></a></pre></body></html>