<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Simulation</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span>
</span><a name="line-4"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span><span class="hs-operator">.</span><span class="hs-identifier">MWC</span><span>
</span><a name="line-5"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Primitive</span><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Math</span><span class="hs-operator">.</span><span class="hs-identifier">LinearAlgebra</span><span class="hs-operator">.</span><span class="hs-identifier">Sparse</span><span class="hs-operator">.</span><span class="hs-identifier">Matrix</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><a href="Settings.html"><span class="hs-identifier">Settings</span></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><a href="Encode.html"><span class="hs-identifier">Encode</span></a><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><a href="Randomization.html"><span class="hs-identifier">Randomization</span></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><a href="Discretization.html"><span class="hs-identifier">Discretization</span></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><a href="Helpers.html"><span class="hs-identifier">Helpers</span></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Test.html"><span class="hs-identifier">Test</span></a><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span class="hs-operator">.</span><span class="hs-identifier">Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Binary</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Directory</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Numeric</span><span class="hs-operator">.</span><span class="hs-identifier">Statistics</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Numeric</span><span class="hs-operator">.</span><span class="hs-identifier">LinearAlgebra</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromList</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toList</span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">DeepSeq</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">rnf</span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">transpose</span><span class="hs-special">,</span><span class="hs-identifier hs-var">sort</span><span class="hs-special">,</span><span class="hs-identifier hs-var">find</span><span class="hs-special">,</span><span class="hs-identifier hs-var">nub</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-identifier">classifiedPaths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-28"></a><a name="classifiedPaths"><a href="Simulation.html#classifiedPaths"><span class="hs-identifier">classifiedPaths</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Discretization.html#classifyTree"><span class="hs-identifier hs-var">classifyTree</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sequence</span><span> </span><a href="Discretization.html#cpp"><span class="hs-identifier hs-var">cpp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679091313"><a href="#local-6989586621679091313"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679091313"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">length</span><span class="hs-special">)</span><span> </span><a href="Discretization.html#cpp"><span class="hs-identifier hs-var">cpp</span></a><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-comment">--- | Paths that are consistent with CARP using singles</span><span>
</span><a name="line-31"></a><span class="hs-identifier">collectiveFilter</span><span> </span><span class="hs-glyph">::</span><span>   </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-32"></a><a name="collectiveFilter"><a href="Simulation.html#collectiveFilter"><span class="hs-identifier">collectiveFilter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Helpers.html#trd3"><span class="hs-identifier hs-var">trd3</span></a><span> </span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-comment">--- | Paths that are inconsistent with CARP but both individuals are rational according to SARP</span><span>
</span><a name="line-35"></a><span class="hs-identifier">noncoorpFilter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-36"></a><a name="noncoorpFilter"><a href="Simulation.html#noncoorpFilter"><span class="hs-identifier">noncoorpFilter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679091314"><a href="#local-6989586621679091314"><span class="hs-identifier">col</span></a></a><span class="hs-special">,</span><a name="local-6989586621679091315"><a href="#local-6989586621679091315"><span class="hs-identifier">indiv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679091315"><span class="hs-identifier hs-var">indiv</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679091314"><span class="hs-identifier hs-var">col</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Helpers.html#trd3"><span class="hs-identifier hs-var">trd3</span></a><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-comment">--- | Paths that are irrational (not collectively rational, and at least one individual fails SARP</span><span>
</span><a name="line-39"></a><span class="hs-identifier">irrationalFilter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-40"></a><a name="irrationalFilter"><a href="Simulation.html#irrationalFilter"><span class="hs-identifier">irrationalFilter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679091316"><a href="#local-6989586621679091316"><span class="hs-identifier">col</span></a></a><span class="hs-special">,</span><a name="local-6989586621679091317"><a href="#local-6989586621679091317"><span class="hs-identifier">indiv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679091317"><span class="hs-identifier hs-var">indiv</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679091316"><span class="hs-identifier hs-var">col</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Helpers.html#trd3"><span class="hs-identifier hs-var">trd3</span></a><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-comment">-- | Paths that are consistent with the aggregate restrictions based on Cherchye et al, not using singles</span><span>
</span><a name="line-43"></a><span class="hs-comment">-- | Only heads are considered, this should be done with [path, [], []] for non-path couple observations</span><span>
</span><a name="line-44"></a><span class="hs-identifier">weakCollectiveFilter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-45"></a><a name="weakCollectiveFilter"><a href="Simulation.html#weakCollectiveFilter"><span class="hs-identifier">weakCollectiveFilter</span></a></a><span> </span><a name="local-6989586621679091318"><a href="#local-6989586621679091318"><span class="hs-identifier">rat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;&amp;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679091318"><span class="hs-identifier hs-var">rat</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Helpers.html#fst3"><span class="hs-identifier hs-var">fst3</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="Simulation.html#possibleFromAggregate"><span class="hs-identifier hs-var">possibleFromAggregate</span></a><span> </span><a href="#local-6989586621679091318"><span class="hs-identifier hs-var">rat</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Helpers.html#fst3"><span class="hs-identifier hs-var">fst3</span></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-identifier">possibleFromAggregate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span>
</span><a name="line-48"></a><a name="possibleFromAggregate"><a href="Simulation.html#possibleFromAggregate"><span class="hs-identifier">possibleFromAggregate</span></a></a><span> </span><a name="local-6989586621679091319"><a href="#local-6989586621679091319"><span class="hs-identifier">rat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>  </span><a href="Helpers.html#histogram"><span class="hs-identifier hs-var">histogram</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679091319"><span class="hs-identifier hs-var">rat</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="Discretization.html#cpp"><span class="hs-identifier hs-var">cpp</span></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-identifier">rationalPathsAndIndices</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><a name="rationalPathsAndIndices"><a href="Simulation.html#rationalPathsAndIndices"><span class="hs-identifier">rationalPathsAndIndices</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679091320"><span class="hs-identifier hs-var">tupleList2Lists</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="Simulation.html#collectiveFilter"><span class="hs-identifier hs-var">collectiveFilter</span></a><span> </span><a href="Simulation.html#classifiedPaths"><span class="hs-identifier hs-var">classifiedPaths</span></a><span> </span><span>
</span><a name="line-52"></a><span>	</span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">tupleList2Lists</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier hs-var">e1</span><span class="hs-special">,</span><span class="hs-identifier">e2</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679091322"><a href="#local-6989586621679091322"><span class="hs-identifier">l1</span></a></a><span class="hs-special">,</span><span class="hs-identifier">l2</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">e1</span><span class="hs-glyph">:</span><span class="hs-identifier">l1</span><span class="hs-special">,</span><span class="hs-identifier">e2</span><span class="hs-glyph">:</span><span class="hs-identifier">l2</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- for tuples (not 3-typles) this is &quot;unzip&quot;</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-comment">-- debug: let (nSimulations, nSample, nPeriods, pRational, nWorstcase) = (1, 10, 3, 1.0, Just (2, [0.333, 0.666]))</span><span>
</span><a name="line-55"></a><span class="hs-comment">-- debug: let idx0 = replicate nPeriods [0..(nSample-1)] in (getChoicePiResampler cpp) idx0 (head $ map join sampledPathss) </span><span>
</span><a name="line-56"></a><span class="hs-identifier">generateChoices</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">PrimMonad</span><span> </span><a href="#local-6989586621679091312"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Gen</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PrimState</span><span> </span><a href="#local-6989586621679091312"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679091312"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SparseMatrix</span><span> </span><span class="hs-identifier hs-type">Double</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><a name="generateChoices"><a href="Simulation.html#generateChoices"><span class="hs-identifier">generateChoices</span></a></a><span> </span><a name="local-6989586621679091325"><a href="#local-6989586621679091325"><span class="hs-identifier">nSimulations</span></a></a><span> </span><a name="local-6989586621679091326"><a href="#local-6989586621679091326"><span class="hs-identifier">nSample</span></a></a><span> </span><a name="local-6989586621679091327"><a href="#local-6989586621679091327"><span class="hs-identifier">pRational</span></a></a><span> </span><a name="local-6989586621679091328"><a href="#local-6989586621679091328"><span class="hs-identifier">nWorstcase</span></a></a><span> </span><a name="local-6989586621679091329"><a href="#local-6989586621679091329"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">--(mA, [vPi]) </span><span>
</span><a name="line-58"></a><span> 	</span><span class="hs-keyword">let</span><span>	</span><span class="hs-special">(</span><span class="hs-identifier">rationalPaths</span><span class="hs-special">,</span><span>	</span><span class="hs-identifier">rationalPathIdcs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rationalPathsAndIndices</span><span> </span><span>
</span><a name="line-59"></a><span>	</span><span class="hs-keyword">let</span><span>	</span><span class="hs-special">(</span><span class="hs-identifier">noncoorpPaths</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">noncoorpPathIdcs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679091333"><a href="#local-6989586621679091333"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">filter</span><span> </span><span class="hs-identifier">noncoorpFilter</span><span> </span><span class="hs-identifier">classifiedPaths</span><span> </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="Simulation.html#classifiedPaths"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">fst3</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">snd3</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span>
</span><a name="line-60"></a><span>	</span><span class="hs-keyword">let</span><span>	</span><span class="hs-identifier">irrationalPaths</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679091335"><a href="#local-6989586621679091335"><span class="hs-identifier">map</span></a></a><span> </span><a name="local-6989586621679091335"><a href="#local-6989586621679091335"><span class="hs-identifier">fst3</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">filter</span><span> </span><span class="hs-identifier">irrationalFilter</span><span> </span><span class="hs-identifier">classifiedPaths</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- original definition</span><span>
</span><a name="line-61"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">weakPaths</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">weakPathIdcs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">weakCollectiveFilter</span><span> </span><span class="hs-identifier">rationalPaths</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">classifiedPaths</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">fst3</span><span> </span><span class="hs-identifier hs-var">p</span><span class="hs-special">,</span><span> </span><a href="Helpers.html#fst3"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">snd3</span><span> </span><span class="hs-identifier hs-var">p</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">finalPool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">finalIdcs</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679091340"><a href="#local-6989586621679091340"><span class="hs-identifier">fnu</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">nWorstcase</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-64"></a><span>		</span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">rationalPaths</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rationalPathIdcs</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679091331"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>		</span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nwc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">distr</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span>
</span><a name="line-66"></a><span>			</span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">first</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">others</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">head</span><span> </span><span class="hs-identifier">rationalPaths</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">head</span><span> </span><a href="#local-6989586621679091330"><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679091330"><span class="hs-identifier hs-var">tail</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">worstCases</span><span> </span><span class="hs-identifier">weakPaths</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Simulation.html#worstCases"><span class="hs-identifier hs-var">first</span></a><span class="hs-special">,</span><span> </span><a href="Simulation.html#worstCases"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679091336"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">rationalPaths</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-operator">/=</span><span> </span><span class="hs-identifier">first</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span>
</span><a name="line-67"></a><span>			</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">pool</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">first</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">take</span><span> </span><span class="hs-identifier">nwc</span><span> </span><span class="hs-identifier">others</span><span>
</span><a name="line-68"></a><span>			</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">poolidcs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">y</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-6989586621679091348"><a href="#local-6989586621679091348"><span class="hs-identifier">snd3</span></a></a><span> </span><a name="local-6989586621679091348"><a href="#local-6989586621679091348"><span class="hs-operator">.</span></a></a><span> </span><span class="hs-identifier">fromJust</span><span> </span><a name="local-6989586621679091349"><a href="#local-6989586621679091349"><span class="hs-operator">$</span></a></a><span> </span><span class="hs-identifier">Data</span><a href="Helpers.html#snd3"><span class="hs-operator hs-var">.</span></a><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier hs-var">find</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier hs-var">x</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fst3</span><span> </span><span class="hs-identifier hs-var">x</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">y</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">classifiedPaths</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">pool</span><span> </span><span class="hs-comment">-- A constructed from either all types or just WC types</span><span>
</span><a name="line-69"></a><span>			</span><span class="hs-special">(</span><span class="hs-identifier">pool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">poolidcs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">distr</span><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">ncpp</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679091353"><a href="#local-6989586621679091353"><span class="hs-identifier">map</span></a></a><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier hs-var">cpp</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">asAssocMatrix'</span><span> </span><span class="hs-identifier">nPeriods</span><span> </span><a href="Discretization.html#nPeriods"><span class="hs-identifier hs-var">ncpp</span></a><span> </span><span class="hs-identifier">finalIdcs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">asAssocMatrix'</span><span> </span><span class="hs-identifier">nPeriods</span><span> </span><a href="Discretization.html#nPeriods"><span class="hs-identifier hs-var">ncpp</span></a><span> </span><span class="hs-identifier">weakPathIdcs</span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">randomPathFromPool</span><span> </span><a name="local-6989586621679091354"><a href="#local-6989586621679091354"><span class="hs-identifier">pool</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomChoicePath</span><span> </span><a href="Randomization.html#randomChoicePath"><span class="hs-identifier hs-var">pool</span></a><span> </span><span class="hs-identifier">fnu</span><span> </span><span class="hs-comment">-- this is a function of s </span><span>
</span><a name="line-73"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nRational</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nAlternative</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">floor</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pRational</span><span> </span><a href="#local-6989586621679091327"><span class="hs-operator hs-var">*</span></a><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">nSample</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ceiling</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">pRational</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679091327"><span class="hs-operator hs-var">*</span></a><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">nSample</span><span> </span><span class="hs-special">)</span><span> </span><span>
</span><a name="line-74"></a><span>	</span><span class="hs-identifier">sampledPathss</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">replicateM</span><span> </span><span class="hs-identifier">nSimulations</span><span> </span><a href="#local-6989586621679091325"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">sequence</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">replicateM</span><span> </span><span class="hs-identifier">nRational</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">randomPathFromPool</span><span> </span><span class="hs-identifier">finalPool</span><span> </span><a href="#local-6989586621679091339"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">replicateM</span><span> </span><span class="hs-identifier">nAlternative</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">randomPathFromPool</span><span> </span><span class="hs-identifier">weakPaths</span><span> </span><a href="#local-6989586621679091336"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span>
</span><a name="line-75"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">dim</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679091359"><a href="#local-6989586621679091359"><span class="hs-identifier">sum</span></a></a><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier hs-var">cpp</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">finalPool</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>	</span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">S</span><span class="hs-operator hs-var">.</span><span class="hs-identifier">fromAssocListWithSize</span><span> </span><span class="hs-identifier hs-var">dim</span><span> </span><span class="hs-identifier hs-var">a0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">transpose</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">join</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">sampledPathss</span><span class="hs-special">)</span><span> </span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-identifier">worstCases</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Helpers.html#HChoice3"><span class="hs-identifier hs-type">HChoice3</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-79"></a><a name="worstCases"><a href="Simulation.html#worstCases"><span class="hs-identifier">worstCases</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-80"></a><span class="hs-identifier">worstCases</span><span> </span><a name="local-6989586621679091360"><a href="#local-6989586621679091360"><span class="hs-identifier">ncos</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679091361"><a href="#local-6989586621679091361"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679091362"><a href="#local-6989586621679091362"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679091361"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679091363"><span class="hs-identifier hs-var">isCloseToNC</span></a><span> </span><a href="#local-6989586621679091361"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Simulation.html#worstCases"><span class="hs-identifier hs-var">worstCases</span></a><span> </span><a href="#local-6989586621679091360"><span class="hs-identifier hs-var">ncos</span></a><span> </span><a href="#local-6989586621679091362"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-81"></a><span>	</span><span class="hs-keyword">where</span><span>
</span><a name="line-82"></a><span>		</span><span class="hs-identifier">isCloseToNC</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">p</span><span class="hs-glyph">:</span><a name="local-6989586621679091363"><a href="#local-6989586621679091363"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679091363"><a href="#local-6989586621679091363"><span class="hs-identifier">any</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">ncos</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nub</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">sequence</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">transpose</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">p</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">ps</span><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span>	</span><span>
</span><a name="line-84"></a><span class="hs-identifier">pickleResults</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Double</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><a name="pickleResults"><a href="Simulation.html#pickleResults"><span class="hs-identifier">pickleResults</span></a></a><span> </span><a name="local-6989586621679091366"><a href="#local-6989586621679091366"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679091367"><a href="#local-6989586621679091367"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeFile</span><span> </span><a href="#local-6989586621679091366"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">encode</span><span> </span><a href="#local-6989586621679091367"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-identifier">unpickleResults</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Double</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span>
</span><a name="line-88"></a><a name="unpickleResults"><a href="Simulation.html#unpickleResults"><span class="hs-identifier">unpickleResults</span></a></a><span> </span><a name="local-6989586621679091368"><a href="#local-6989586621679091368"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-89"></a><span>	</span><span class="hs-identifier">handle</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">openFile</span><span> </span><span class="hs-identifier hs-var">f</span><span> </span><span class="hs-identifier">ReadMode</span><span> </span><span>
</span><a name="line-90"></a><span>	</span><span class="hs-identifier">content</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a name="local-6989586621679091680"><a href="#local-6989586621679091680"><span class="hs-identifier">B</span><span class="hs-operator">.</span></a></a><span class="hs-identifier">hGetContents</span><span> </span><span class="hs-identifier hs-var">handle</span><span> </span><span>
</span><a name="line-91"></a><span>	</span><span class="hs-identifier">rnf</span><span> </span><span class="hs-identifier">content</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621679091680"><span class="hs-identifier hs-var">seq</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">hClose</span><span> </span><span class="hs-identifier hs-var">handle</span><span>
</span><a name="line-92"></a><span>	</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">decode</span><span> </span><span class="hs-identifier">content</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-comment">-- debug: let (s, b, nSample, nPeriods, pRational,  nWorstcase, fixedTau, mFct) = let wc = (2,[0.333,0.666]) in (1, 50, 1000, 3, 1.0, Just wc, Just ((minimum . snd) wc), id)</span><span>
</span><a name="line-95"></a><span class="hs-comment">-- debug: let res = [calculateTestStatistic fixedTau smA (getChoicePiResampler cpp) (head bidcss) (head sampledPathss)]</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- debug: let (svPi, bidcs, cs) = (getChoicePiResampler cpp, head bidcss, head sampledPathss) </span><span>
</span><a name="line-97"></a><span class="hs-comment">-- debug: let (dmA, dvPi) = ((fromLists . S.fillMx) smA, Numeric.LinearAlgebra.fromList (Sv.fillVec (svPi idx0 cs)))</span><span>
</span><a name="line-98"></a><span class="hs-identifier">simulationPerPN</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-99"></a><a name="simulationPerPN"><a href="Simulation.html#simulationPerPN"><span class="hs-identifier">simulationPerPN</span></a></a><span> </span><a name="local-6989586621679091958"><a href="#local-6989586621679091958"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679091959"><a href="#local-6989586621679091959"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679091960"><a href="#local-6989586621679091960"><span class="hs-identifier">nSample</span></a></a><span> </span><a name="local-6989586621679091961"><a href="#local-6989586621679091961"><span class="hs-identifier">pRational</span></a></a><span> </span><a name="local-6989586621679091962"><a href="#local-6989586621679091962"><span class="hs-identifier">nWorstcase</span></a></a><span> </span><a name="local-6989586621679091963"><a href="#local-6989586621679091963"><span class="hs-identifier">fixedTau</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-100"></a><span>	</span><span class="hs-identifier">seed</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">create</span><span>
</span><a name="line-101"></a><span>	</span><span class="hs-special">(</span><span class="hs-identifier">smA</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sampledChoicess</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">generateChoices</span><span> </span><a href="Simulation.html#generateChoices"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-identifier">nSample</span><span> </span><span class="hs-identifier">pRational</span><span> </span><span class="hs-identifier">nWorstcase</span><span> </span><a href="#local-6989586621679091962"><span class="hs-identifier hs-var">seed</span></a><span> </span><span>
</span><a name="line-102"></a><span>	</span><span class="hs-identifier">bidcss</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">replicateM</span><span> </span><span class="hs-identifier hs-var">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">bootstrapIdcs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">replicate</span><span> </span><span class="hs-identifier">nPeriods</span><span> </span><span class="hs-identifier">nSample</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679091960"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-identifier">seed</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">calculateTestStatistic</span><span> </span><span class="hs-identifier">fixedTau</span><span> </span><a href="#local-6989586621679091963"><span class="hs-identifier hs-var">smA</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">getChoicePiResampler</span><span> </span><a href="Discretization.html#getChoicePiResampler"><span class="hs-identifier hs-var">cpp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">bidcss</span><span> </span><span class="hs-identifier">sampledChoicess</span><span> </span><span>
</span><a name="line-105"></a><span>	</span><span class="hs-comment">--writeEmpDist nSample (truncate (pRational*100)) ((fst3 . head) res) ((snd3 . head) res)</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">evaluator</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679091969"><a href="#local-6989586621679091969"><span class="hs-identifier">j</span></a></a><span class="hs-special">,</span><a name="local-6989586621679091969"><a href="#local-6989586621679091969"><span class="hs-identifier">js</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679091970"><a href="#local-6989586621679091970"><span class="hs-identifier">_</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">boolToDouble</span><span> </span><a href="Helpers.html#boolToDouble"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Helpers.html#boolToDouble"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="Helpers.html#boolToDouble"><span class="hs-operator hs-var">&gt;</span></a><span> </span><span class="hs-identifier">percentile</span><span> </span><span class="hs-identifier hs-var">tau</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromList</span><span> </span><span class="hs-identifier hs-var">js</span><span class="hs-special">)</span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">tau</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">90</span><span class="hs-special">,</span><span class="hs-number">95</span><span class="hs-special">,</span><span class="hs-number">99</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-108"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">rejFreqs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">vPr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">evaluator</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679091969"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">meanList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">vPr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">toList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">varianceList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">vPr</span><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>	</span><span class="hs-identifier">print</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">nSample</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pRational</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nWorstcase</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rejFreqs</span><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span>	</span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">rejFreqs</span><span> </span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-identifier">resumeSimulation</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-114"></a><a name="resumeSimulation"><a href="Simulation.html#resumeSimulation"><span class="hs-identifier">resumeSimulation</span></a></a><span> </span><a name="local-6989586621679091975"><a href="#local-6989586621679091975"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679091976"><a href="#local-6989586621679091976"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679091977"><a href="#local-6989586621679091977"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679091978"><a href="#local-6989586621679091978"><span class="hs-identifier">mFct</span></a></a><span> </span><a name="local-6989586621679091979"><a href="#local-6989586621679091979"><span class="hs-identifier">nWorstcase</span></a></a><span> </span><a name="local-6989586621679091980"><a href="#local-6989586621679091980"><span class="hs-identifier">fixedTau</span></a></a><span> </span><a name="local-6989586621679091981"><a href="#local-6989586621679091981"><span class="hs-identifier">nSample</span></a></a><span> </span><a name="local-6989586621679091982"><a href="#local-6989586621679091982"><span class="hs-identifier">pRational</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679091983"><span class="hs-identifier hs-var">loaded</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679091984"><span class="hs-identifier hs-var">decide</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679091981"><span class="hs-identifier hs-var">nSample</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679091982"><span class="hs-identifier hs-var">pRational</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679091979"><span class="hs-identifier hs-var">nWorstcase</span></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-115"></a><span>	</span><span class="hs-keyword">where</span><span>
</span><a name="line-116"></a><span>		</span><span class="hs-identifier">loaded</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">doesFileExist</span><span> </span><span class="hs-identifier hs-var">fp</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">exists</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">exists</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">unpickleResults</span><span> </span><a href="Simulation.html#unpickleResults"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>		</span><span class="hs-identifier">decide</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier">Double</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Double</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier">Double</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Double</span><span class="hs-special">]</span><span class="hs-special">)</span><span>	</span><span>
</span><a name="line-118"></a><span>		</span><span class="hs-identifier">decide</span><span> </span><span class="hs-identifier">Nothing</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-119"></a><span>			</span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">simulationPerPN</span><span> </span><a name="local-6989586621679091986"><a href="#local-6989586621679091986"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">nSample</span><span> </span><span class="hs-identifier">pRational</span><span> </span><span class="hs-identifier">nWorstcase</span><span> </span><a href="#local-6989586621679091982"><span class="hs-identifier hs-var">fixedTau</span></a><span>
</span><a name="line-120"></a><span>			</span><span class="hs-identifier">rs</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">loaded</span><span>
</span><a name="line-121"></a><span>			</span><span class="hs-identifier">pickleResults</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">nSample</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pRational</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nWorstcase</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679091982"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679091982"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-122"></a><span>			</span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">r</span><span>
</span><a name="line-123"></a><span>		</span><span class="hs-identifier">decide</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">r</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier hs-var">r</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-identifier">plotPower</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-126"></a><a name="plotPower"><a href="Simulation.html#plotPower"><span class="hs-identifier">plotPower</span></a></a><span> </span><a name="local-6989586621679091989"><a href="#local-6989586621679091989"><span class="hs-identifier">simName</span></a></a><span> </span><a name="local-6989586621679091990"><a href="#local-6989586621679091990"><span class="hs-identifier">resFileName</span></a></a><span> </span><a name="local-6989586621679091991"><a href="#local-6989586621679091991"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span>
</span><a name="line-127"></a><span>	</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unpickleResults</span><span> </span><span class="hs-identifier">resFileName</span><span>
</span><a name="line-128"></a><span>	</span><span class="hs-comment">-- there must be a more elegant lens-way to do this</span><span>
</span><a name="line-129"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">graph</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679091993"><a href="#local-6989586621679091993"><span class="hs-identifier">M</span><span class="hs-operator">.</span></a></a><span class="hs-identifier">elems</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier">mapWithKey</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier hs-var">k</span><span> </span><span class="hs-identifier hs-var">v</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1.0</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">snd</span><span> </span><span class="hs-identifier">k</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">fst</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator">.</span><span class="hs-identifier">filterWithKey</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier hs-var">k</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">fst</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier hs-var">n</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator">.</span><span class="hs-identifier">fromAscList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">n</span><span class="hs-special">,</span><span class="hs-identifier">p</span><span class="hs-special">,</span><span class="hs-identifier">wc</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679092103"><a href="#local-6989586621679092103"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">n</span><span class="hs-special">,</span><span class="hs-identifier">p</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">res</span><span>  </span><span>
</span><a name="line-130"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">exportstring</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Monad</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">join</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unwords</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">x</span><span class="hs-special">)</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">graph</span><span> </span><span>
</span><a name="line-131"></a><span>	</span><span class="hs-identifier">writeFile</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">resultsPrefix</span><span> </span><a href="Settings.html#resultsPrefix"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;power.&quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">simName</span><span> </span><a href="#local-6989586621679091989"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;.&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier hs-var">n</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.csv&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">exportstring</span><span>
</span><a name="line-132"></a><span>	</span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span class="hs-identifier">plotSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-135"></a><a name="plotSize"><a href="Simulation.html#plotSize"><span class="hs-identifier">plotSize</span></a></a><span> </span><a name="local-6989586621679092108"><a href="#local-6989586621679092108"><span class="hs-identifier">simName</span></a></a><span> </span><a name="local-6989586621679092109"><a href="#local-6989586621679092109"><span class="hs-identifier">resFileName</span></a></a><span> </span><a name="local-6989586621679092110"><a href="#local-6989586621679092110"><span class="hs-identifier">n0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span>
</span><a name="line-136"></a><span>	</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unpickleResults</span><span> </span><span class="hs-identifier">resFileName</span><span>
</span><a name="line-137"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">graph</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679092112"><a href="#local-6989586621679092112"><span class="hs-identifier">sort</span></a></a><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier">toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier">filterWithKey</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier hs-var">k</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">snd</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">n0</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">M</span><a href="#local-6989586621679092110"><span class="hs-operator hs-var">.</span></a><span class="hs-identifier">fromAscList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">n</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n0'</span><span class="hs-special">,</span><span class="hs-identifier hs-var">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679092116"><a href="#local-6989586621679092116"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">n</span><span class="hs-special">,</span><span class="hs-identifier">n0'</span><span class="hs-operator">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679092116"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">res</span><span>
</span><a name="line-138"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">values</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679092118"><a href="#local-6989586621679092118"><span class="hs-identifier">map</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">snd</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">graph</span><span>
</span><a name="line-139"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">titles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679092119"><a href="#local-6989586621679092119"><span class="hs-identifier">map</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">fst</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">graph</span><span>
</span><a name="line-140"></a><span>	</span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">exportstring</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;titles &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unwords</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">t</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span class="hs-operator">++</span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier hs-var">t</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">titles</span><span> </span><a href="#local-6989586621679092119"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;\n&quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">join</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier hs-var">k</span><span> </span><span class="hs-identifier hs-var">v</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unwords</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">v</span><span class="hs-special">)</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;$0.1$&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;$0.05$&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;$0.01$&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">transpose</span><span> </span><span class="hs-identifier hs-var">values</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>	</span><span class="hs-identifier">writeFile</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">resultsPrefix</span><span> </span><a href="Settings.html#resultsPrefix"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;size.&quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">simName</span><span> </span><a href="#local-6989586621679092108"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;.&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier">n0</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.csv&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">exportstring</span><span>
</span><a name="line-142"></a><span>	</span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a></pre></body></html>